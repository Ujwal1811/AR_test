<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Motorev 3D + AR Viewer</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.2/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        /* Viewer Container */
        #viewer-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        /* 3D Viewer (default visible) */
        #model-viewer {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        /* AR Viewer (initially hidden) */
        #ar-viewer {
            width: 100%;
            height: 100%;
            display: none;
        }
        
        /* Data Panel */
        .data-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            color: orange;
            z-index: 100;
        }
        
        /* Control Buttons */
        .control-panel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            gap: 10px;
        }
        
        button {
            background-color: orange;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* AR Hint */
        .ar-hint {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="viewer-container">
        <!-- Regular 3D Viewer -->
        <a-scene id="model-viewer" embedded>
            <a-assets>
                <a-asset-item id="motorev-model" src="motorev.glb"></a-asset-item>
            </a-assets>
            
            <a-entity 
                gltf-model="#motorev-model"
                scale="0.1 0.1 0.1"
                position="0 0.5 -2"
                rotation="0 0 0"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 10000">
            </a-entity>
            
            <a-entity position="0 0 0">
                <a-entity camera look-controls></a-entity>
            </a-entity>
            
            <a-sky color="#222222"></a-sky>
        </a-scene>
        
        <!-- AR Viewer -->
        <a-scene id="ar-viewer" embedded arjs="sourceType: webcam; debugUIEnabled: false;">
            <a-marker preset="hiro">
                <a-entity 
                    gltf-model="#motorev-model"
                    scale="0.1 0.1 0.1"
                    position="0 0 0"
                    rotation="0 0 0">
                </a-entity>
            </a-marker>
            <a-entity camera></a-entity>
        </a-scene>
        
        <!-- Data Panel -->
        <div class="data-panel">
            <div>Voltage: <span id="voltage">46.7 V</span></div>
            <div>Current: <span id="current">0.6 A</span></div>
            <div>Temp: <span id="temperature">93.7 °C</span></div>
            <div>SOC: <span id="soc">85.6 %</span></div>
            <div>SOH: <span id="soh">95.3 %</span></div>
            <div>Speed: <span id="speed">0.1 km/h</span></div>
            <div>Range: <span id="range">81.0 km</span></div>
            <div>Status: <span id="status">3D View</span></div>
        </div>
        
        <!-- AR Hint -->
        <div class="ar-hint" id="ar-hint">Point camera at Hiro marker</div>
        
        <!-- Control Buttons -->
        <div class="control-panel">
            <button id="ar-button">View in AR</button>
            <button id="reset-button">Reset View</button>
        </div>
    </div>

    <script>
        // DOM Elements
        const modelViewer = document.getElementById('model-viewer');
        const arViewer = document.getElementById('ar-viewer');
        const arButton = document.getElementById('ar-button');
        const resetButton = document.getElementById('reset-button');
        const arHint = document.getElementById('ar-hint');
        const statusElement = document.getElementById('status');
        
        // Toggle between 3D and AR views
        arButton.addEventListener('click', () => {
            if (modelViewer.style.display === 'none') {
                // Switch back to 3D view
                modelViewer.style.display = 'block';
                arViewer.style.display = 'none';
                arHint.style.display = 'none';
                statusElement.textContent = '3D View';
                arButton.textContent = 'View in AR';
            } else {
                // Switch to AR view
                modelViewer.style.display = 'none';
                arViewer.style.display = 'block';
                arHint.style.display = 'block';
                statusElement.textContent = 'Scanning for marker...';
                arButton.textContent = 'Exit AR';
                
                // Set up AR marker detection
                const arScene = document.querySelector('#ar-viewer');
                arScene.addEventListener('markerFound', () => {
                    arHint.style.display = 'none';
                    statusElement.textContent = 'AR Active';
                });
                
                arScene.addEventListener('markerLost', () => {
                    arHint.style.display = 'block';
                    statusElement.textContent = 'Scanning for marker...';
                });
            }
        });
        
        // Reset 3D view
        resetButton.addEventListener('click', () => {
            const camera = document.querySelector('#model-viewer [camera]');
            camera.setAttribute('position', '0 0 0');
            camera.setAttribute('rotation', '0 0 0');
        });
        
        // Update dummy data
        function updateData() {
            const elements = {
                voltage: { min: 46, max: 48, unit: 'V' },
                current: { min: 0.4, max: 0.7, unit: 'A' },
                temperature: { min: 90, max: 95, unit: '°C' },
                soc: { min: 80, max: 90, unit: '%' },
                soh: { min: 95, max: 97, unit: '%' },
                speed: { min: 0, max: 0.2, unit: 'km/h' },
                range: { min: 80, max: 85, unit: 'km' }
            };
            
            Object.entries(elements).forEach(([id, config]) => {
                const value = (Math.random() * (config.max - config.min) + config.min).toFixed(1);
                document.getElementById(id).textContent = `${value} ${config.unit}`;
            });
        }
        
        // Initial data update
        updateData();
        setInterval(updateData, 1500);
    </script>
</body>
</html>
